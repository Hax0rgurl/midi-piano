<html><head><base href="https://musicworld.websim/"><title>AI MIDI Generator with Chords - MusicWorld</title><style>body{background:#000000;color:#00ff00;display:flex;flex-direction:column;align-items:center;min-height:100vh;margin:0;font-family:'Roboto',sans-serif;padding:20px}.container{width:100%;max-width:1200px}.piano{background:#111111;padding:20px;border-radius:15px;box-shadow:0 10px 30px rgba(0,255,0,0.3);margin-bottom:30px;overflow-x:auto}.keys{display:flex;position:relative;width:4400px}.white-key{width:50px;height:180px;background:#222222;border:1px solid #00ff00;border-radius:0 0 8px 8px;cursor:pointer;transition:all 0.3s ease}.black-key{width:30px;height:110px;background:#000000;position:absolute;cursor:pointer;z-index:1;border-radius:0 0 5px 5px;transition:all 0.3s ease;border:1px solid #00ff00}.white-key:active,.black-key:active,.white-key.active,.black-key.active{transform:scale(0.98);box-shadow:0 2px 10px rgba(0,255,0,0.5)}.white-key:active,.white-key.active{background:#00ff00}.black-key:active,.black-key.active{background:#00ff00}.controls{background:rgba(0,0,0,0.8);padding:20px;border-radius:15px;box-shadow:0 5px 15px rgba(0,255,0,0.3);margin-bottom:30px;backdrop-filter:blur(10px);border:1px solid #00ff00}select,button,input,textarea{background:#000000;color:#00ff00;border:1px solid #00ff00;padding:10px 15px;font-size:16px;margin:5px;border-radius:8px;transition:all 0.3s ease}select:focus,input:focus,textarea:focus{outline:none;box-shadow:0 0 0 2px #00ff00}button{background:#000000;color:#00ff00;font-weight:bold;cursor:pointer;transition:all 0.3s ease}button:hover{background:#003300;transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,255,0,0.4)}#status{margin-top:15px;font-style:italic;color:#00ff00}#midi-container{background:rgba(0,0,0,0.8);border-radius:15px;box-shadow:0 5px 15px rgba(0,255,0,0.3);padding:20px;backdrop-filter:blur(10px);border:1px solid #00ff00}#midi-input{width:calc(100% - 30px);margin-bottom:15px;background:#000000;color:#00ff00;resize:vertical}#playback-controls{display:flex;justify-content:space-between;margin-top:15px}#midi-text{width:100%;height:200px;margin-top:20px;resize:vertical;font-family:'Courier New',monospace;background:#000000;color:#00ff00;border:1px solid #00ff00;padding:10px;border-radius:8px}.recording{background-color:#ff0000 !important;color:#000000 !important}#volume-control{display:flex;align-items:center;margin-top:10px}#volume-slider{-webkit-appearance:none;width:100%;height:5px;border-radius:5px;background:#00ff00;outline:none;opacity:0.7;transition:opacity .2s}#volume-slider:hover{opacity:1}#volume-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#00ff00;cursor:pointer}#volume-slider::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#00ff00;cursor:pointer}#volume-label{margin-left:10px;font-size:14px}.highlight{background-color:rgba(0,255,0,0.5) !important}.midi-line-highlight{background-color:#003300}</style></head><body>
  <div class="container">
    <div class="piano">
  <div class="keys">
    <!-- White keys -->
    <div class="white-key" data-note="C"></div>
    <div class="white-key" data-note="D"></div>
    <div class="white-key" data-note="E"></div>
    <div class="white-key" data-note="F"></div>
    <div class="white-key" data-note="G"></div>
    <div class="white-key" data-note="A"></div>
    <div class="white-key" data-note="B"></div>
    <div class="white-key" data-note="C"></div>
    <div class="white-key" data-note="D"></div>
    <div class="white-key" data-note="E"></div>
    <div class="white-key" data-note="F"></div>
    <div class="white-key" data-note="G"></div>
    <div class="white-key" data-note="A"></div>
    <div class="white-key" data-note="B"></div>
    <div class="white-key" data-note="C"></div>
    <div class="white-key" data-note="D"></div>
    <div class="white-key" data-note="E"></div>
    <div class="white-key" data-note="F"></div>
    <div class="white-key" data-note="G"></div>
    <div class="white-key" data-note="A"></div>
    <div class="white-key" data-note="B"></div>
    <div class="white-key" data-note="C"></div>

    <!-- Black keys -->
    <div class="black-key" data-note="C#" style="left: 35px;"></div>
    <div class="black-key" data-note="D#" style="left: 85px;"></div>
    <div class="black-key" data-note="F#" style="left: 185px;"></div>
    <div class="black-key" data-note="G#" style="left: 235px;"></div>
    <div class="black-key" data-note="A#" style="left: 285px;"></div>
    <div class="black-key" data-note="C#" style="left: 385px;"></div>
    <div class="black-key" data-note="D#" style="left: 435px;"></div>
    <div class="black-key" data-note="F#" style="left: 535px;"></div>
    <div class="black-key" data-note="G#" style="left: 585px;"></div>
    <div class="black-key" data-note="A#" style="left: 635px;"></div>
    <div class="black-key" data-note="C#" style="left: 735px;"></div>
    <div class="black-key" data-note="D#" style="left: 785px;"></div>
    <div class="black-key" data-note="F#" style="left: 885px;"></div>
    <div class="black-key" data-note="G#" style="left: 935px;"></div>
    <div class="black-key" data-note="A#" style="left: 985px;"></div>
  </div>
</div>

    <div class="controls">
      <select id="instrument-select">
        <option value="piano">Piano</option>
        <option value="organ">Organ</option>
        <option value="guitar">Guitar</option>
        <option value="synth">Synth</option>
        <option value="strings">Strings</option>
      </select>
      <select id="octave-select">
        <option value="0">Octave 0</option>
        <option value="1">Octave 1</option>
        <option value="2">Octave 2</option>
        <option value="3">Octave 3</option>
        <option value="4" selected="">Octave 4</option>
        <option value="5">Octave 5</option>
        <option value="6">Octave 6</option>
        <option value="7">Octave 7</option>
      </select>
      <button id="record">Record</button>
      <button id="download-midi">Download MIDI File</button>
      <div id="volume-control">
        <input type="range" id="volume-slider" min="0" max="100" value="50">
        <span id="volume-label">Volume: 50%</span>
      </div>
      <div id="status"></div>
    </div>

    <div id="midi-container">
      <textarea id="midi-input" rows="3" placeholder="Describe the MIDI you want to generate, including chords and harmonies..."></textarea>
      <button id="generate-midi">Generate Complex MIDI Song</button>
      <div id="playback-controls">
        <button id="play">Play on Piano</button>
        <button id="stop">Stop</button>
      </div>
      <textarea id="midi-text" readonly="" placeholder="MIDI text will appear here after generation or recording">
     MIDI File Content:


</textarea>
    </div>
  </div>

<script>
//things to fnish: create midi with timing, key changes, harmonies, bass, lead melody
//create functional download button(must remain on the page. open dialogue to download,
//dowload as wav function and download button.
  
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
let currentInstrument = 'piano';
let currentOctave = 4;
let midiSequence = null;
let isPlaying = false;
let currentNoteIndex = 0;
let startTime = 0;
let isRecording = false;
let recordedNotes = [];
let recordStartTime;
let masterGainNode = audioContext.createGain();
masterGainNode.connect(audioContext.destination);

const instruments = {
  piano: { type: 'triangle', attack: 0.02, decay: 0.1, sustain: 0.3, release: 0.1 },
  organ: { type: 'sine', attack: 0.02, decay: 0.3, sustain: 0.8, release: 0.1 },
  guitar: { type: 'sawtooth', attack: 0.02, decay: 0.1, sustain: 0.2, release: 0.1 },
  synth: { type: 'square', attack: 0.02, decay: 0.3, sustain: 0.4, release: 0.1 },
  strings: { type: 'modulated-sine', attack: 0.1, decay: 0.3, sustain: 0.8, release: 0.2 }
};

const baseNoteFrequencies = {
  'C0': 16.35, 'C#0': 17.32, 'D0': 18.35, 'D#0': 19.45, 'E0': 20.60, 'F0': 21.83, 'F#0': 23.12, 'G0': 24.50, 'G#0': 25.96, 'A0': 27.50, 'A#0': 29.14, 'B0': 30.87,
  'C1': 32.70, 'C#1': 34.65, 'D1': 36.71, 'D#1': 38.89, 'E1': 41.20, 'F1': 43.65, 'F#1': 46.25, 'G1': 49.00, 'G#1': 51.91, 'A1': 55.00,'A#1': 58.27, 'B1': 61.74,
  'C2': 65.41, 'C#2': 69.30, 'D2': 73.42, 'D#2': 77.78, 'E2': 82.41, 'F2': 87.31, 'F#2': 92.50, 'G2': 98.00, 'G#2': 103.83, 'A2': 110.00, 'A#2': 116.54, 'B2': 123.47,
  'C3': 130.81, 'C#3': 138.59, 'D3': 146.83, 'D#3': 155.56, 'E3': 164.81, 'F3': 174.61, 'F#3': 185.00, 'G3': 196.00, 'G#3': 207.65, 'A3': 220.00, 'A#3': 233.08, 'B3': 246.94,
  'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13, 'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
  'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99, 'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77,
  'C6': 1046.50, 'C#6': 1108.73, 'D6': 1174.66, 'D#6': 1244.51, 'E6': 1318.51, 'F6': 1396.91, 'F#6': 1479.98, 'G6': 1567.98, 'G#6': 1661.22, 'A6': 1760.00, 'A#6': 1864.66, 'B6': 1975.53,
  'C7': 2093.00, 'C#7': 2217.46, 'D7': 2349.32, 'D#7': 2489.02, 'E7': 2637.02, 'F7': 2793.83, 'F#7': 2959.96, 'G7': 3135.96, 'G#7': 3322.44, 'A7': 3520.00, 'A#7': 3729.31, 'B7': 3951.07,
  'C8': 4186.01
};

function playNote(note, volume = 1.0) {
  const fullNote = `${note}${currentOctave}`;
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.type = instruments[currentInstrument].type;
  oscillator.frequency.setValueAtTime(baseNoteFrequencies[fullNote], audioContext.currentTime);
  
  gainNode.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + instruments[currentInstrument].attack);
  gainNode.gain.linearRampToValueAtTime(instruments[currentInstrument].sustain * volume, audioContext.currentTime + instruments[currentInstrument].attack + instruments[currentInstrument].decay);
  
  oscillator.connect(gainNode);
  gainNode.connect(masterGainNode);
  
  oscillator.start();
  
  return { oscillator, gainNode };
}

function stopNote(noteObj) {
  const { oscillator, gainNode } = noteObj;
  gainNode.gain.setValueAtTime(gainNode.gain.value, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + instruments[currentInstrument].release);
  oscillator.stop(audioContext.currentTime + instruments[currentInstrument].release);
}

document.querySelectorAll('.white-key, .black-key').forEach(key => {
  key.addEventListener('mousedown', () => {
    const note = key.dataset.note;
    key.classList.add('active');
    const noteObj = playNote(note);
    key.noteObj = noteObj;
    
    if (isRecording) {
      const time = audioContext.currentTime - recordStartTime;
      recordedNotes.push({ note: `${note}${currentOctave}`, time, duration: 0, volume: 1.0, type: 'main' });
    }
  });
  
  key.addEventListener('mouseup', () => {
    key.classList.remove('active');
    if (key.noteObj) {
      stopNote(key.noteObj);
      
      if (isRecording) {
        const lastNote = recordedNotes[recordedNotes.length - 1];
        lastNote.duration = audioContext.currentTime - recordStartTime - lastNote.time;
      }
    }
  });
});

document.getElementById('instrument-select').addEventListener('change', (e) => {
  currentInstrument = e.target.value;
});

document.getElementById('octave-select').addEventListener('change', (e) => {
  currentOctave = parseInt(e.target.value);
});

document.getElementById('volume-slider').addEventListener('input', (e) => {
  const volume = e.target.value / 100;
  masterGainNode.gain.setValueAtTime(volume, audioContext.currentTime);
  document.getElementById('volume-label').textContent = `Volume: ${e.target.value}%`;
});

document.getElementById('record').addEventListener('click', () => {
  if (!isRecording) {
    isRecording = true;
    recordedNotes = [];
    recordStartTime = audioContext.currentTime;
    document.getElementById('record').classList.add('recording');
    document.getElementById('record').textContent = 'Stop Recording';
  } else {
    isRecording = false;
    document.getElementById('record').classList.remove('recording');
    document.getElementById('record').textContent = 'Record';
    displayRecordedNotes();
  }
});

function displayRecordedNotes() {
  let midiText = '';
  recordedNotes.forEach(note => {
    midiText += `${note.note},${note.time.toFixed(2)},${note.duration.toFixed(2)},${note.volume.toFixed(1)},${note.type}\n`;
  });
  document.getElementById('midi-text').value = midiText;
}

function parseMidiText(midiText) {
  return midiText.trim().split('\n').map(line => {
    const [note, time, duration, volume, type] = line.split(',');
    return { note, time: parseFloat(time), duration: parseFloat(duration), volume: parseFloat(volume), type };
  });
}

document.getElementById('play').addEventListener('click', () => {
  if (!midiSequence) {
    const midiText = document.getElementById('midi-text').value;
    midiSequence = parseMidiText(midiText);
  }
  
  if (midiSequence.length > 0) {
    isPlaying = true;
    currentNoteIndex = 0;
    startTime = audioContext.currentTime;
    playNextNote();
  }
});

function playNextNote() {
  if (!isPlaying || currentNoteIndex >= midiSequence.length) {
    isPlaying = false;
    return;
  }
  
  const { note, time, duration, volume, type } = midiSequence[currentNoteIndex];
  const noteObj = playNote(note.slice(0, -1), volume);
  
  highlightKey(note.slice(0, -1));
  highlightMidiLine(currentNoteIndex);
  
  setTimeout(() => {
    stopNote(noteObj);
    unhighlightKey(note.slice(0, -1));
  }, duration * 1000);
  
  currentNoteIndex++;
  
  const nextNoteTime = time * 1000;
  setTimeout(playNextNote, nextNoteTime);
}

function highlightKey(note) {
  const key = document.querySelector(`[data-note="${note}"]`);
  if (key) key.classList.add('highlight');
}

function unhighlightKey(note) {
  const key = document.querySelector(`[data-note="${note}"]`);
  if (key) key.classList.remove('highlight');
}

function highlightMidiLine(index) {
  const midiTextArea = document.getElementById('midi-text');
  const lines = midiTextArea.value.split('\n');
  const highlightedLines = lines.map((line, i) => 
    i === index ? `<span class="midi-line-highlight">${line}</span>` : line
  );
  midiTextArea.innerHTML = highlightedLines.join('\n');
}

document.getElementById('stop').addEventListener('click', () => {
  isPlaying = false;
  document.querySelectorAll('.white-key, .black-key').forEach(key => {
    key.classList.remove('highlight');
  });
});

document.getElementById('download-midi').addEventListener('click', () => {
  const midiText = document.getElementById('midi-text').value;
  const blob = new Blob([midiText], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  
  // Open a new window with the MIDI content
  const newWindow = window.open('', '_blank');
  newWindow.document.write('<pre>' + midiText + '</pre>');
  newWindow.document.title = 'Generated MIDI';
  
  // Create a download link in the new window
  const downloadLink = newWindow.document.createElement('a');
  downloadLink.href = url;
  downloadLink.download = 'generated_midi.mid';
  downloadLink.textContent = 'Download MIDI File';
  newWindow.document.body.appendChild(downloadLink);
  
  URL.revokeObjectURL(url);
});

document.getElementById('generate-midi').addEventListener('click', () => {
  const midiInput = document.getElementById('midi-input').value;
  const statusElement = document.getElementById('status');
  
  statusElement.textContent = 'Generating full song...';
  
  // Simulating an API call to generate a full song
  setTimeout(() => {
    // This is a placeholder for the actual song generation
    const generatedSong = generateFullSong();
    
    document.getElementById('midi-text').value = generatedSong;
    midiSequence = parseMidiText(generatedSong);
    statusElement.textContent = 'Full song generated successfully!';
  }, 3000); // Simulating a 3-second delay for generation
});

function generateFullSong() {
  const songLength = Math.random() * 30 + 90; // 90-120 seconds
  const bpm = Math.floor(Math.random() * 40 + 80); // 80-120 BPM
  const beatDuration = 60 / bpm;
  const isMinor = Math.random() < 0.5;
  
  const scale = isMinor ? ['C', 'D', 'D#', 'F', 'G', 'G#', 'A#'] : ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
  const chords = [
    [0, 2, 4], // I
    [5, 0, 2], // VI
    [3, 5, 0], // IV
    [4, 6, 1]  // V
  ];
  
  let song = '';
  let currentTime = 0;
  
  while (currentTime < songLength) {
    const chordProgression = shuffleArray([0, 1, 2, 3]);
    
    for (const chordIndex of chordProgression) {
      const chord = chords[chordIndex];
      
      // Main melody
      const melodyNote = scale[Math.floor(Math.random() * scale.length)] + '4';
      song += `${melodyNote},${currentTime.toFixed(2)},${beatDuration.toFixed(2)},1.0,main\n`;
      
      // Chord
      for (const note of chord) {
        const chordNote = scale[note] + '3';
        song += `${chordNote},${currentTime.toFixed(2)},${(beatDuration * 4).toFixed(2)},0.6,harmony\n`;
      }
      
      // Bass
      const bassNote = scale[chord[0]] + '2';
      song += `${bassNote},${currentTime.toFixed(2)},${(beatDuration * 4).toFixed(2)},0.8,bass\n`;
      
      currentTime += beatDuration * 4;
    }
  }
  
  return song.trim();
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
  // Set initial volume
  const volumeSlider = document.getElementById('volume-slider');
  masterGainNode.gain.setValueAtTime(volumeSlider.value / 100, audioContext.currentTime);
  
  // Enable audio context on user interaction
  document.body.addEventListener('click', () => {
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
  }, { once: true });
});

console.log("Piano updated to change notes according to selected octave!");
</script>
</body></html>
